<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="layui/css/layui.css">
	<link rel="stylesheet" href="layui/css/styles.css">
	<script type="text/javascript" charset="utf-8" src="js/jquery-3.2.1.js"></script>
</head>
<body>
<div style="position:absolute;left:220px;top:100px">
	<fieldset class="layui-elem-field layui-field-title" style="margin-top:0px">
		<legend>密码修改</legend>
	</fieldset>
	<form class="layui-form" name="changekey-form">
		<div class="layui-form-item">
			<label class="layui-form-label">请输入原密码</label>
			<div class="layui-input-inline">
				<input name="oldpsw" class="layui-input" type="password" placeholder="请输入原密码" autocomplete="off" style="width:260px"
						onblur="oBlur_check_oldpsw()" onFocus="oFocus_oldpsw()">
				<span id="reminder_oldpsw" style="color:red;font-weight:700"></span>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">请输入新密码</label>
			<div class="layui-input-inline">
				<input name="newpsw" class="layui-input" type="password" placeholder="新密码格式为6~16个英文字符及数字、下划线"style="width:260px"
						onblur="oBlur_check_newpsw()" onFocus="oFocus_newpsw()" autocomplete="off">
				<span id="reminder_newpsw" style="color:red;font-weight:700"></span>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">请确认新密码</label>
			<div class="layui-input-inline">
				<input name="confpsw" class="layui-input" type="password" placeholder="请确认新密码" autocomplete="off" style="width:260px"
					onblur="oBlur_check_confpsw()" onFocus="oFocus_confpsw()">
					<span id="reminder_confpsw" style="color:red;font-weight:700"></span>
			</div>
		</div>
		<div class="layui-form-item">
			<div class="layui-input-block">
				<button type="button" class="layui-btn" style="width:87px" onclick="changekey_check()">提交</button>
				<button class="layui-btn layui-btn-primary" type="reset" style="width:87px">重置</button>
			</div>
		</div>
	</form>
<div>
<script type="text/javascript">
	function changekey_check()
	{
	  var old_password=document.forms["changekey-form"]["oldpsw"].value;
	  var new_password=document.forms["changekey-form"]["newpsw"].value;
	  var confirm_password=document.forms["changekey-form"]["confpsw"].value;
	  if (old_password==null || old_password==""){
		alert("请填写原密码");
		return false;
		}
	  if (new_password==null || new_password==""){
		alert("请填写新密码");
		return false;
		}
	  if (confirm_password==null || confirm_password==""){
		alert("请再次确认新密码");
		return false;
		}
	  if(check_password(new_password)==false){
		  alert("请检查新密码格式是否正确");
		  }
	  if(new_password!=confirm_password)
		{
		  alert("两次密码输入不一致");
		  return false;
		}
		var temp={"data":{"old_password":old_password,"new_password":new_password,"confirm_password":confirm_password}};
		var str = JSON.stringify(temp);
		alert(str);
		$(function(){
        $.ajax({ 
             url: "php/changekey.php",  
             type: "POST", 
             data:{res:str}, 
             dataType: "json", 
             error: function(){   
                 alert('Error loading XML document');   
             },   
             success: function(data){
				if(data.success=="true"){
					alert("修改密码成功！");
				}else{
					alert(data.error);
				}
			} 
		});
	}); 
	  return true;
	}
  /*
  函数说明:验证密码有效格式
  参数：密码
  返回：true/false
  备注：密码格式为6~16个英文字符及数字、下划线
  */
	  function check_password(password)
	  {
		  var parten=/^([A-Z a-z 0-9 _ ]{6,16})$/;
		  if(parten.test(password)){
		  return true; 
		  }
		  else{
		  return false; 
		  }
	  }
  /*
  函数说明:新密码框失去焦点后验证密码
  参数：
  返回：
  备注：密码格式为6~16个英文字符及数字、下划线
  */
	  function oBlur_check_oldpsw()
	  {
		 var old_password=document.forms["changekey-form"]["oldpsw"].value;
		 if (old_password==null || old_password==""){
			 document.getElementById("reminder_oldpsw").innerHTML = "请输入原密码！";
		 }else{
			 document.getElementById("reminder_oldpsw").innerHTML = "";
		 }
	  }
   /*
  函数说明:新密码框失去焦点后验证密码
  参数：
  返回：
  备注：密码格式为6~16个英文字符及数字、下划线
  */
	  function oBlur_check_newpsw()
	  {
		 var new_password=document.forms["changekey-form"]["newpsw"].value;
		 if (new_password==null || new_password==""){
			 document.getElementById("reminder_newpsw").innerHTML = "请输入密码！";
		 }
		 else if(check_password(new_password)==false){
			 document.getElementById("reminder_newpsw").innerHTML = "密码格式不正确";
				  }	
		 else{
			 document.getElementById("reminder_newpsw").innerHTML = "";
		 }
	  }
 /*
 函数说明:再次确认密码框失去焦点后验证确认密码
 参数：
 返回：
 备注：再次确认密码必须与输入的密码一致
 */
	  function oBlur_check_confpsw()
	  {
		 var confirm_password=document.forms["changekey-form"]["confpsw"].value;
		 var new_password=document.forms["changekey-form"]["newpsw"].value;
		if (confirm_password==null || confirm_password=="")
		  {
				document.getElementById("reminder_confpsw").innerHTML = "请再次确认密码！";
		  }
		 else{
			  if(confirm_password!=new_password){
				  document.getElementById("reminder_confpsw").innerHTML = "两次密码输入不一致";
					 }   
			  else{
					document.getElementById("reminder_confpsw").innerHTML = "";
				   }
			 }
	  }
/*
函数说明：原密码框获得焦点的隐藏提醒
参数：
返回：
*/
	function oFocus_oldpsw() {
		document.getElementById("reminder_oldpsw").innerHTML = "";
	}
	
/*
函数说明：新密码框获得焦点的隐藏提醒
参数：
返回：
*/
	function oFocus_newpsw() {
		document.getElementById("reminder_newpsw").innerHTML = "";
	}
/*
函数说明:再次确认密码框获得焦点的隐藏提醒
参数：
返回：
*/
	function oFocus_confpsw() {
		document.getElementById("reminder_confpsw").innerHTML = "";
	}
</script>
</body>
</html>
